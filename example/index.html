<!DOCTYPE html>
<html lang="en">
<head>
<title>Reticulum | Basic VR Example</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<style type="text/css">
	html, body {
		background-color: #000;
		margin: 0;
		padding: 0; 
		overflow: hidden;
	}
</style>
</head>

<body>

<script type="text/javascript">
	var CARDBOARD_DEBUG = false;
</script>
<script src="js/deps/three.js"></script>
<script src="js/deps/VRControls.js"></script>
<script src="js/deps/VREffect.js"></script>
<script src="js/deps/webvr-polyfill.js"></script>
<script src="js/webvr-manager.js"></script>
<script src="../reticulum.js"></script>

<script>
//Setup three.js WebGL renderer
var renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);
var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.3, 4000);
var controls = new THREE.VRControls(camera);
var effect = new THREE.VREffect(renderer);
effect.setSize(window.innerWidth, window.innerHeight);
var manager = new WebVRManager(renderer, effect, {hideButton: false});





var hemiLight = new THREE.HemisphereLight(0x0000ff, 0x00ff00, 0.6);
hemiLight.position.set(0, 500, 0);
scene.add(hemiLight);
var geometry = new THREE.BoxGeometry( 20, 20, 20 );
for ( var i = 0; i < 2000; i ++ ) {

	var object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } ) );

	object.position.x = Math.random() * 1200 - 400;
	object.position.y = Math.random() * 1200 - 400;
	object.position.z = Math.random() * 1200 - 400;

	
	// *******************************
	// --- Reticulum ---
	// have the object react when user looks at it
	object.ongazeover = function(){
		this.material.emissive.setHex( 0xffcc00 );
	}
	// have the object react when user looks away from it
	object.ongazeout = function(){
		this.material.emissive.setHex( 0xcc0000 );
	}
	// have the object react when user looks at it for a specific time
	object.ongazelong = function(){
		this.material.emissive.setHex( 0x0000cc );
	}

	// track the object
	Reticulum.addCollider(object);

	scene.add( object );

}


// *******************************
// --- Reticulum ---
// initiate Reticulum so it loads up 
Reticulum.init({
	camera: camera,
	gazing_duration: 2.5,
	crosshair: {
		visible: true,
		color: 0xcc0000,
		radius: 0.005,
		tube: 0.001
	}
});

// IMPORTANT add camera to cene if you want to see a crosshair 
scene.add(camera);






function animate() {
	requestAnimationFrame(animate);
	controls.update();
	manager.render(scene, camera);

	// *******************************
	// --- Reticulum ---
	// keep checking if user is looking at any tracked objects
		Reticulum.loop();

	
}
animate();


function onKey(event) {
  if (event.keyCode == 90) { // z
    controls.resetSensor();
  }
};

window.addEventListener('keydown', onKey, true);

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  effect.setSize( window.innerWidth, window.innerHeight );
}
window.addEventListener('resize', onWindowResize, false);

</script>
</body>
</html>